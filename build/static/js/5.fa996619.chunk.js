(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{225:function(e,t,a){"use strict";a.d(t,"c",function(){return r}),a.d(t,"e",function(){return s}),a.d(t,"d",function(){return n}),a.d(t,"b",function(){return c}),a.d(t,"a",function(){return o});var r="https://shenzekun-qmusic-api.now.sh/",s="https://shenzekun-qmusic-api.now.sh/top",n="https://shenzekun-qmusic-api.now.sh/search",c="https://shenzekun-qmusic-api.now.sh/lyrics",o="https://shenzekun-qmusic-api.now.sh/hotkey"},231:function(e,t,a){"use strict";a.d(t,"d",function(){return s}),a.d(t,"b",function(){return n}),a.d(t,"a",function(){return c}),a.d(t,"c",function(){return o});var r=a(225);function s(e){return"https://api.bzqll.com/music/tencent/url?key=579621905&id=".concat(e)}function n(e){return"".concat(r.b,"?id=").concat(e)}function c(e){return"https://y.gtimg.cn/music/photo_new/T002R150x150M000".concat(e,".jpg")}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"".concat(r.d,"?keyword=").concat(e,"&page=").concat(t)}},232:function(e,t,a){"use strict";var r=a(243),s=a.n(r),n=a(244),c=a.n(n);s.a.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded";var o=s.a.create({timeout:3e4,transformRequest:[function(e){return c.a.stringify(e)}],headers:{"Content-Type":"application/x-www-form-urlencoded"}});o.interceptors.request.use(function(e){return e.data||(e.data={}),e.data.token="",e},function(e){return Promise.reject(e)}),o.interceptors.response.use(function(e){return e.data},function(e){if(e&&e.response)switch(e.response.status){case 400:e.message="\u9519\u8bef\u8bf7\u6c42";break;case 401:e.message="\u672a\u6388\u6743\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55";break;case 403:e.message="\u62d2\u7edd\u8bbf\u95ee";break;case 404:e.message="\u8bf7\u6c42\u9519\u8bef,\u672a\u627e\u5230\u8be5\u8d44\u6e90";break;case 405:e.message="\u8bf7\u6c42\u65b9\u6cd5\u672a\u5141\u8bb8";break;case 408:e.message="\u8bf7\u6c42\u8d85\u65f6";break;case 500:e.message="\u670d\u52a1\u5668\u7aef\u51fa\u9519";break;case 501:e.message="\u7f51\u7edc\u672a\u5b9e\u73b0";break;case 502:e.message="\u7f51\u7edc\u9519\u8bef";break;case 503:e.message="\u670d\u52a1\u4e0d\u53ef\u7528";break;case 504:e.message="\u7f51\u7edc\u8d85\u65f6";break;case 505:e.message="http\u7248\u672c\u4e0d\u652f\u6301\u8be5\u8bf7\u6c42";break;default:e.message="\u8fde\u63a5\u9519\u8bef".concat(e.response.status)}else e.message="\u8fde\u63a5\u5230\u670d\u52a1\u5668\u5931\u8d25";return Promise.resolve(e.response)});var i=o,l=a(225),u=a(231);a.d(t,"d",function(){return p}),a.d(t,"c",function(){return y}),a.d(t,"a",function(){return d}),a.d(t,"e",function(){return f}),a.d(t,"b",function(){return g});var p=function(){return i({url:l.c})},y=function(){return i({url:l.e})},d=function(){return i({url:l.a})},f=function(e,t){return i({url:Object(u.c)(e,t)})},g=function(e){return i({url:Object(u.b)(e)})}},234:function(e,t,a){"use strict";a.d(t,"a",function(){return r}),a.d(t,"b",function(){return s});var r=function(e){return"number"===typeof e&&e>1e4?(e/1e4).toFixed(1)+"\u4e07":e},s=function(e){var t=Math.floor(e/60),a=Math.floor(e%60);return t<10&&(t="0"+t),a<10&&(a="0"+a),"".concat(t,":").concat(a)}},252:function(e,t,a){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}a.d(t,"a",function(){return r})},296:function(e,t,a){e.exports={player:"player_player__1oe6v",player_container:"player_player_container__3ySOq",player_header:"player_player_header__25Oxv",album_cover:"player_album_cover__1o6qa",song_info:"player_song_info__2j-fY",song_name:"player_song_name__3VY63",song_artist:"player_song_artist__2S8Yu",icon_action:"player_icon_action__2F4Ey",icon_play:"player_icon_play__FdpZY",icon_pause:"player_icon_pause__2uRzj",player_lyrics:"player_player_lyrics__2tu5u",player_lyrics_list:"player_player_lyrics_list__14bnJ",player_lyrics_item:"player_player_lyrics_item__3nmZS",player_footer:"player_player_footer__s3r4B",icon_collect:"player_icon_collect__1gYaS",progress:"player_progress__2vDAp",progress_bar:"player_progress_bar__3VsNH",progress_bar_progress:"player_progress_bar_progress__3N72v",progress_time:"player_progress_time__sgxDZ",action:"player_action__GDjd_",btn_download:"player_btn_download__1d_Qz",player_background:"player_player_background__3BMqs"}},308:function(e,t,a){"use strict";a.r(t);var r=a(252),s=a(226),n=a(227),c=a(229),o=a(228),i=a(230),l=a(242),u=a(1),p=a.n(u),y=a(66),d=a(231),f=a(232),g=a(234),_=a(296),m=a.n(_),h=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,i=new Array(n),u=0;u<n;u++)i[u]=arguments[u];return(a=Object(c.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(i)))).audioRef=null,a.playerLyricsListRef=null,a.progressRef=null,a.progressBarRef=null,a.state={isLoading:!1,duration:0,progress:0,elapsed:0,progressIntervalId:0,progressMoving:!1,progressBarWidth:0,startPageX:0,movePageX:0,lyrics:[],lyricIndex:0,LINE_HEIGHT:42,lyricIntervalId:0},a.getLyrics=function(){var e=a.props.song.songid;a.setState({isLoading:!0}),Object(f.b)(e).then(function(e){var t=e.lyric;t=a.formatText(t).match(/^\[\d{2}:\d{2}.\d{2}\](.+)$/gm),a.setState({lyricIndex:0,lyrics:Array.isArray(t)?Object(r.a)(t):[]})}).catch(function(e){console.error(e)}).then(function(){a.setState({isLoading:!1})})},a.onPlay=function(){var e=a.props,t=e.isPlay,r=e.setPlayState;if(t)try{a.audioRef.pause(),r(!1),a.pauseLyrics(),a.pauseProgress()}catch(s){}else{if(a.state.isLoading)return;try{a.audioRef.play(),r(!0),a.startLyrics(),a.startProgress()}catch(s){}}},a.handleOnAudioEnd=function(){try{a.audioRef.play(),a.restartLyrics(),a.resetProgress()}catch(e){}},a.startLyrics=function(){a.pauseLyrics(),a.setState({lyricIntervalId:setInterval(a.updateLyrics,1e3)})},a.pauseLyrics=function(){clearInterval(a.state.lyricIntervalId)},a.updateLyrics=function(){var e=Object(l.a)(Object(l.a)(a));try{if(a.audioRef.ontimeupdate=function(t){for(var a=0,r=e.state.lyrics.length;a<r;a++)e.audioRef.currentTime>e.getSeconds(e.state.lyrics[a])-.5&&(e.playerLyricsListRef.children[e.state.lyricIndex]&&e.playerLyricsListRef.children[e.state.lyricIndex].classList.remove("active"),e.playerLyricsListRef.children[a]&&e.playerLyricsListRef.children[a].classList.add("active"),e.setState({lyricIndex:a}))},a.state.lyricIndex>2){var t=-(a.state.lyricIndex-2)*a.state.LINE_HEIGHT;a.playerLyricsListRef.style.transform="translateY(".concat(t,"px)")}}catch(r){}},a.resetLyrics=function(){a.pauseLyrics(),a.playerLyricsListRef.children[a.state.lyricIndex]&&a.playerLyricsListRef.children[a.state.lyricIndex].classList.remove("active"),a.setState({lyricIndex:0}),a.playerLyricsListRef.style.transform="translateY(0)",a.state.lyrics.length&&a.playerLyricsListRef.children[0]&&a.playerLyricsListRef.children[0].classList.add("active")},a.restartLyrics=function(){a.resetLyrics(),a.startLyrics()},a.startProgress=function(){a.pauseProgress(),a.setState({progressIntervalId:setInterval(a.updateProgress,50)})},a.pauseProgress=function(){clearInterval(a.state.progressIntervalId)},a.updateProgress=function(){var e=a.state,t=e.elapsed,r=e.duration,s=t+.05;a.setState({elapsed:s,progress:s/r}),a.progressRef.style.transform="translateX(".concat(100*a.state.progress-100,"%)")},a.resetProgress=function(e){a.pauseProgress();var t={elapsed:0,progress:0};e&&(t.duration=+e),a.setState(t),a.progressRef.style.transform="translateX(-100%)"},a.restartProgress=function(){a.resetProgress(),a.startProgress()},a.progressTouchStart=function(e){a.setState({progressMoving:!0,startPageX:e.touches[0].pageX,startOffsetLeft:e.target.offsetLeft,progressBarWidth:a.progressBarRef.offsetWidth})},a.progressTouchMove=function(e){var t=e.touches[0].pageX,r=Math.min(a.state.progressBarWidth,Math.max(0,a.state.startOffsetLeft+(t-a.state.startPageX))),s=Math.floor(r/a.state.progressBarWidth*100)*a.state.duration/100;a.setState({movePageX:t,elapsed:s})},a.progressTouchEnd=function(e){a.setState({progressMoving:!1}),a.audioRef.currentTime=a.state.elapsed},a}return Object(i.a)(t,e),Object(n.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.song;this.setState({duration:e.interval}),this.getLyrics()}},{key:"componentWillUnmount",value:function(){try{var e=this.props.setPlayState;this.audioRef.pause(),e(!1),this.pauseLyrics(),this.pauseProgress()}catch(t){}}},{key:"getSeconds",value:function(e){return+e.replace(/^\[(\d{2}):(\d{2}\.\d{2}).*/,function(e,t,a){return 60*+t+parseFloat(+a)})}},{key:"formatText",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText}},{key:"getAlbumCover",value:function(e){return Object(d.a)(e)}},{key:"getSongUrl",value:function(e){return Object(d.d)(e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.isShowPlayer,r=t.isPlay,s=t.song,n=t.artist,c=this.state,o=c.lyrics,i=void 0===o?[]:o,l=c.elapsed,y=c.isLoading;return p.a.createElement(u.Fragment,null,a&&p.a.createElement("div",{className:"".concat(m.a.player)},p.a.createElement("div",{className:m.a.player_container},p.a.createElement("div",{className:m.a.player_header},p.a.createElement("img",{className:m.a.album_cover,src:this.getAlbumCover(s.albummid),alt:s.songname}),p.a.createElement("div",{className:m.a.song_info},p.a.createElement("div",{className:m.a.song_name},s.songname),p.a.createElement("div",{className:m.a.song_artist},n)),p.a.createElement("i",{className:"".concat(m.a.icon_action," ").concat(m.a[r?"icon_pause":"icon_play"]),onClick:this.onPlay})),p.a.createElement("div",{className:m.a.player_lyrics},p.a.createElement("div",{className:m.a.player_lyrics_list,ref:function(t){return e.playerLyricsListRef=t}},i&&i.length>0&&i.map(function(e,t){return p.a.createElement("div",{className:m.a.player_lyrics_item,key:t},e.slice(10))}),y&&p.a.createElement("div",{className:m.a.player_lyrics_item},"\u6b63\u5728\u52a0\u8f7d\u6b4c\u8bcd,\u8bf7\u7b49\u5f85..."))),p.a.createElement("div",{className:m.a.player_footer},p.a.createElement("i",{className:m.a.icon_collect}),p.a.createElement("div",{className:m.a.progress},p.a.createElement("div",{className:"".concat(m.a.progress_time," ").concat(m.a.progress_elapsed)},Object(g.b)(l)),p.a.createElement("div",{className:m.a.progress_bar,ref:function(t){return e.progressBarRef=t}},p.a.createElement("div",{className:m.a.progress_bar_progress,ref:function(t){return e.progressRef=t},onTouchStart:this.progressTouchStart,onTouchMove:this.progressTouchMove,onTouchEnd:this.progressTouchEnd})),p.a.createElement("div",{className:"".concat(m.a.progress_time," ").concat(m.a.progress_duration)},Object(g.b)(s.interval))),p.a.createElement("div",{className:m.a.action},p.a.createElement("span",{className:m.a.btn_download},"\u4e0b\u8f7d\u8fd9\u9996\u6b4c")))),p.a.createElement("div",{className:m.a.player_background,style:{backgroundImage:"url("+this.getAlbumCover(s.albummid)+")"}}),p.a.createElement("audio",{src:this.getSongUrl(s.songmid),ref:function(t){return e.audioRef=t},onEnded:this.handleOnAudioEnd})))}}]),t}(u.PureComponent);t.default=Object(y.connect)(function(e,t){return{isShowPlayer:e.app.isShowPlayer,isPlay:e.app.isPlay,song:e.app.song,artist:e.app.artist}},function(e){return{getSong:function(t){e({type:"app/getSong",payload:t})},showPlayer:function(){e({type:"app/showPlayer"})},cancelPlayer:function(){e({type:"app/cancelPlayer"})},setPlayState:function(t){e({type:"app/setPlayState",payload:t})}}})(h)}}]);
//# sourceMappingURL=5.fa996619.chunk.js.map